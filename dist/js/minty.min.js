/*! Minty v2.0.0 (https://github.com/shingchi/Minty) | by shingchi <shingchi@sina.cn> 2014-12-22 | Licensed under MIT */ 
!function(e,t){"use strict";var n,o,s,a=[],r=".minty",l=e.minty;o={dom:{getAll:function(){var t,n,o;return 1===arguments.length?(t=e.document.documentElement,n=arguments[0]):(t=arguments[0],n=arguments[1]),t&&t.querySelectorAll&&(o=t.querySelectorAll(n)),o},get:function(){var e=this.getAll.apply(this,arguments);return e&&e.length&&(e=e[e.length-1]),e},getData:function(t,n){var o,s=e.navigator.userAgent;return o=/msie/i.test(s)?t.getAttribute("data-"+n):t.dataset[n]},setData:function(t,n,o){var s=e.navigator.userAgent;/msie/i.test(s)?t.setAttribute("data-"+n,o):t.dataset[n]=o}},css:{has:function(e,n){var o=new RegExp("(^|\\s)"+n+"(\\s|$)");return e.className!==t?o.test(e.className):!1},add:function(e,t){return e&&t&&!this.has(e,t)?void(e.className=(e.className?e.className+" ":"")+t):!1},remove:function(e,t){var n;return e&&t&&this.has(e,t)?(n=new RegExp("( "+t+")|("+t+")","g"),void(e.className=e.className.replace(n,""))):!1},toggle:function(e,t){var n,o;n=this.has(e,t),o=n?this.remove:this.add,o.apply(this,[e,t])},swap:function(e,t,n){var o={className:e.className};this.remove(o,t),this.add(o,n),e.className=o.className}},events:{add:function(t,n,o){var s={detach:function(){return remove(t,n,o)}};return e.addEventListener?t.addEventListener(n,o,!1):t.attachEvent("on"+n,o),s},remove:e.removeEventListener!==t?function(e,t,n){return e.removeEventListener(t,n,!1)}:function(e,t,n){return e.detachEvent("on"+t,n)}}},s={req:function(e){var t,n={method:e.type||"GET",url:((e.url||location.href)+"").replace("/#.*$/","").replace("/^///",location.protocol+"//"),data:e.data||null,dataType:e.dataType||"json",async:e.async||!0,callback:e.callback||new Function};t=this.xhr.call(this),n.data&&(n.url=this.setUrl(n.url,n.data)),t.open(n.method,n.url,n.async),t.setRequestHeader("Content-Type","charset=UTF-8"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Minty-Hash",l.hash),t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){var e="json"!=n.dataType?t.responseText:JSON.parse(t.responseText);n.callback.call(this,e)}else console.error("Bad Request: "+t.statusText)};try{t.send()}catch(o){}},xhr:function(){try{return new XMLHttpRequest}catch(e){}},setUrl:function(e,t){var n,o=[];for(var s in t)o.push(s+"="+t[s]);return n=o.join("&"),e+(/\?/.test(e)?"&":"?")+n}},n=function(n){function a(){function e(){return f.sources}function n(n){var o,s;return null===f.selectedIndex?n:(o=e(),n=n!==t?n:f.selectedIndex,s=o[n])}function s(){var e,t=f.sources.length;return null!==f.selectedIndex&&f.selectedIndex++,t>1?f.selectedIndex>=t?1==f.loop?(e=n(0),f.selectedIndex=0):(e=n(f.selectedIndex),f.selectedIndex--):e=n(f.selectedIndex):1==f.loop?(e=n(0),f.selectedIndex=0):(e=n(f.selectedIndex),f.selectedIndex=0),e}function a(){return f.selectedIndex--,f.selectedIndex<0&&(1==f.loop?f.selectedIndex=f.sources.length-1:f.selectedIndex++),n()}function r(){var e,t="."+y.selected;if(null!==f.sources&&(e=o.dom.getAll(g.playlist,t)),e)for(var n=0;n<e.length;n++)o.css.remove(e[n],y.selected)}function l(e){var n;if(r(),e!==t&&null!==e){n=o.dom.getAll(g.playlist,"li");for(var s=0;s<n.length;s++)if(e==s){o.css.add(n[s],y.selected);break}}f.selectedIndex=e}function i(){var e,t;return e=n(),e&&(t=e.src),t}return{getNext:s,getPrevious:a,getSource:n,select:l,getURL:i}}function r(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),o=Math.floor(t%60);return(10>n?"0":"")+n+":"+(10>o?"0":"")+o}function i(e){var t;t=f.sources,g.controls.detail.innerHTML=t[e].title+" - "+t[e].author}function c(){f.sources.length>1&&o.css.add(g.playlist,y.menu)}function u(e){var t=soundManager.createSound({url:e,whileplaying:function(){var e;e=Math.min(100,Math.max(0,100*this.position/this.durationEstimate))+"%",this.duration&&(g.controls.progress.played.style.width=e,g.controls.duration.innerHTML="-"+r(this.duration-this.position))},onbufferchange:function(e){e?o.css.add(g.player,"buffering"):o.css.remove(g.player,"buffering")},onplay:function(){o.css.swap(g.controls.button.play,"paused","playing")},onpause:function(){o.css.swap(g.controls.button.play,"playing","paused")},onresume:function(){o.css.swap(g.controls.button.play,"paused","playing")},whileloading:function(){var e=this.bytesLoaded/this.bytesTotal*100+"%";g.controls.progress.loaded.style.width=e,this.isHTML5||(g.controls.duration.innerHTML=r(this.durationEstimate))},onload:function(e){e?g.controls.duration.innerHTML=r(this.duration):this._iO&&this._iO.onerror&&this._iO.onerror()},onerror:function(){var e;e=x.getSource(),e&&(g.controls.detail.innerHTML="错误: 当前歌曲无法播放"),o.css.swap(g.controls.button.play,"playing","paused")},onstop:function(){o.css.remove(g.controls.button.play,"playing")},onfinish:function(){var e;o.css.remove(g.controls.button.play,"playing"),g.controls.progress.played.style.width=0,g.controls.duration.innerHTML="00:00",e=x.getNext(),x.select(f.selectedIndex),i(f.selectedIndex),e&&this.play({url:e.src})}});return t}function d(e){var t=f.sources[e];soundManager.canPlayURL(t.src)&&(b||(b=u(t.src)),b.stop(),x.select(e),i(e),b.play({url:t.src,position:0}))}function p(n){if(!(t==n||null==n||n.length<1)){f.sources=n,f.auto=o.dom.getData(g.player,"auto"),f.loop=o.dom.getData(g.player,"loop");for(var s=0;s<n.length;s++){var r=e.document.createElement("li");r.innerHTML=n[s].title+" - "+n[s].author,o.dom.setData(r,"index",s),g.playlist.appendChild(r)}x=new a,x.select(0),1==f.auto&&d(0),i(0),c(),o.events.add(g.player,"click",v.handleClick),o.events.add(g.controls.progress.track,"click",v.handleShuffle)}}function m(){n||console.warn("Could not find any elements of player!"),g.player=n,g.playlist=o.dom.get(g.player,h.playlist),g.controls.main=o.dom.get(g.player,h.controls.main),g.controls.progress.track=o.dom.get(g.controls.main,h.controls.progress.track),g.controls.progress.loaded=o.dom.get(g.controls.main,h.controls.progress.loaded),g.controls.progress.played=o.dom.get(g.controls.main,h.controls.progress.played),g.controls.button.play=o.dom.get(g.controls.main,h.controls.button.play),g.controls.button.volume=o.dom.get(g.controls.main,h.controls.button.volume),g.controls.button.menu=o.dom.get(g.controls.main,h.controls.button.menu),g.controls.duration=o.dom.get(g.controls.main,h.controls.duration),g.controls.detail=o.dom.get(g.controls.main,h.controls.detail),e.navigator.userAgent.match(/mobile/i)&&o.css.add(g.player,y.noVolume);var t=o.dom.getData(g.player,"songs"),a=o.dom.getData(g.player,"type"),r=o.dom.getData(g.player,"serve");s.req({url:l.apiUrl,data:{serve:r,"do":a,id:t},callback:p})}var g,y,f,h,v,x,b;h={playlist:".minty-playlist",controls:{main:".minty-controls",progress:{track:".minty-progress",loaded:".minty-progress-loaded",played:".minty-progress-played"},button:{play:".minty-button-play",volume:".minty-button-volume",menu:".minty-button-menu"},duration:".minty-duration",detail:".minty-detail"}},y={disabled:"disabled",selected:"selected",active:"active",noVolume:"no-volume",mute:"mute",menu:"open"},g={player:null,playlist:null,controls:{main:null,progress:{track:null,loaded:null,played:null},button:{play:null,volume:null,menu:null},duration:null,detail:null}},f={auto:!1,loop:!0,selectedIndex:0,sources:null},m(),v={handleClick:function(t){var n,s,a,r,l,i;if(n=t||e.event,s=n.target||n.srcElement,s&&s.nodeName&&(a=s.nodeName.toLowerCase(),"li"===a&&(r=o.dom.getData(s,"index"),l=f.sources[r].src,f.selectedIndex===r?(b||(b=u(l)),b.togglePause()):soundManager.canPlayURL(l)&&d(r),i=!0),"i"===a)){var c=new RegExp("minty-button-play"),p=new RegExp("minty-button-volume"),m=new RegExp("minty-button-menu");c.test(s.className)&&(r=f.selectedIndex,l=f.sources[r].src,b||(b=u(l)),x.select(r),b.togglePause(),i=!0),p.test(s.className)&&(b&&(b.toggleMute(),o.css.toggle(g.controls.button.volume,y.mute)),i=!0),m.test(s.className)&&(o.css.toggle(g.playlist,y.menu),i=!0)}return i?void 0:!1},handleShuffle:function(e){function t(e){var t=0;if(e.offsetParent)for(;e.offsetParent;)t+=e.offsetLeft,e=e.offsetParent;else e.x&&(t+=e.x);return t}var n,o,s,a,r,l;return n=g.controls.progress.track,o=t(n),s=n.offsetWidth,a=e.clientX-o,r=a/s,l=b,l&&l.duration&&(l.setPosition(l.duration*r),l._iO.whileplaying.apply(l)),!1}}},soundManager.setup({html5PollingInterval:50,flashVersion:9}),soundManager.onready(function(){var e;if(e=o.dom.getAll(r),e&&e.length)for(var t=0;t<e.length;t++)a.push(new n(e[t]))})}(this);