/*! Minty v1.0.0 | by shingchi <shingchi@sina.cn> (https://github.com/shingchi) | Licensed under MIT | 2014-12-17 */ 
!function(e){{var t,a=[],n=".minty",s=minty.apiUrl;minty.swfUrl}soundManager.setup({html5PollingInterval:50,flashVersion:9}),soundManager.onready(function(){e(n).each(function(){a.push(new t(e(this)))})}),t=function(t,a){function n(){I=e.extend({},b,a)}function o(){var e,a,n;e=t.find(I.selecter.controls),a=t.find(I.selecter.playlist),n=e.find(I.selecter.progress),m={player:t,controls:e,playlist:a,progress:n,progressLoaded:n.find(I.selecter.progressLoaded),progressPlayed:n.find(I.selecter.progressPlayed),duration:e.find(I.selecter.duration),detail:e.find(I.selecter.detail),button:{play:e.find(I.selecter.button.play),volume:e.find(I.selecter.button.volume),menu:e.find(I.selecter.button.menu)}}}function r(){function t(){return I.data.sources}function a(e){var a;return null===I.data.selectedIndex?e:(a=t(),e=void 0!==e?e:I.data.selectedIndex,source=a[e])}function n(){return null!==I.data.selectedIndex&&I.data.selectedIndex++,I.data.sources.length>1?I.data.selectedIndex>=I.data.sources.length&&(I.data.loop?I.data.selectedIndex=0:I.data.selectedIndex--):I.data.selectedIndex=null,a()}function s(){return I.data.selectedIndex--,I.data.selectedIndex<0&&(I.data.loop?I.data.selectedIndex=I.data.sources.length-1:I.data.selectedIndex++),a()}function o(){var t,a="."+I.css.selected;null!==I.data.sources&&(t=m.playitem.filter(a)),t&&t.each(function(){e(this).removeClass(I.css.selected)})}function r(t){var a;o(),(void 0!==t||null!==t)&&(a=m.playitem[t],e(a).addClass(I.css.selected)),I.data.selectedIndex=t}function l(){var e,t;return e=a(),e&&(t=e.src),t}return{getNext:n,getPrevious:s,getSource:a,getURL:l,select:r}}function l(e,t){var a=Math.floor(e/1e3),n=Math.floor(a/3600),s=Math.floor(a/60)-Math.floor(60*n),o=Math.floor(a-3600*n-60*s);return t?(n?n+":":"")+(n&&10>s?"0"+s:s)+":"+(10>o?"0"+o:o):{min:s,sec:o}}function d(e){var t;t=I.data.sources,m.detail.html(t[e].title+" - "+t[e].author)}function i(){var e=I.data.sources.length;e>1&&m.playlist.addClass(I.css.menu)}function u(e){var t=soundManager.createSound({url:e,whileplaying:function(){var e;e=Math.min(100,Math.max(0,100*this.position/this.durationEstimate))+"%",this.duration&&(m.progressPlayed.css("width",e),m.duration.html("-"+l(this.duration-this.position,!0)))},onbufferchange:function(e){e?m.player.addClass("buffering"):m.player.removeClass("buffering")},onplay:function(){m.button.play.removeClass("paused").addClass("playing")},onpause:function(){m.button.play.removeClass("playing").addClass("paused")},onresume:function(){m.button.play.removeClass("paused").addClass("playing")},whileloading:function(){var e=this.bytesLoaded/this.bytesTotal*100+"%";m.progressLoaded.css("width",e),this.isHTML5||m.duration.html(l(this.durationEstimate,!0))},onload:function(e){e?m.duration.html(l(this.duration,!0)):this._iO&&this._iO.onerror&&this._iO.onerror()},onerror:function(){var e;e=v.getSource(),e&&m.detail.html("错误: 当前歌曲无法播放"),m.button.play.removeClass("playing").addClass("paused")},onstop:function(){m.button.play.removeClass("playing")},onfinish:function(){var e,t;m.button.play.removeClass("playing"),m.progressPlayed.css("width",0),e=I.data.selectedIndex,t=v.getNext(),t&&I.data.selectedIndex!==e&&(v.select(I.data.selectedIndex),d(I.data.selectedIndex),this.play({url:v.getURL()}))}});return t}function c(e){var t=I.data.sources[e];soundManager.canPlayURL(t.src)&&(h||(h=u(t.src)),h.stop(),v.select(e),d(e),h.play({url:t.src,position:0}))}function p(){if(I.data.type=m.player.data("type"),I.data.id=m.player.data("songs"),void 0!==m.player.data("auto")&&(I.data.auto=m.player.data("auto")),void 0!==m.player.data("loop")&&(I.data.loop=m.player.data("loop")),e.ajax({url:s,dataType:"json",async:!1,data:{"do":I.data.type,id:I.data.id},success:function(e){I.data.sources=e},error:function(){console.error("无法获取媒体信息")}}),I.data.sources&&I.data.sources.length>0){for(var t=0;t<I.data.sources.length;t++){var a=I.data.sources[t].title,n=I.data.sources[t].author,o='<li data-index="'+t+'">'+a+" - "+n+"</li>";m.playlist.append(o)}m.playitem=m.playlist.children()}}function f(){t||console.warn("init(): No playerNode element?"),n(),o(),p(),v=new r,v.select(0),I.data.auto&&c(0),d(0),i(),x.add(m.player.get(0),"click",y),x.add(m.progress.get(0),"click",g)}function y(t){var a,n,s,o,r,l;if(a=t||window.event,n=a.target||a.srcElement,n&&n.nodeName&&(s=n.nodeName.toLowerCase(),"li"===s&&(o=e(n).data("index"),r=I.data.sources[o].src,I.data.selectedIndex===o?(h||(h=u(r)),h.togglePause()):soundManager.canPlayURL(r)&&c(o),l=!0),"i"===s)){var d=I.selecter.button.play.replace(".",""),i=I.selecter.button.volume.replace(".",""),p=I.selecter.button.menu.replace(".",""),f=e(n).attr("class").toString();f.indexOf(d)>=0&&(o=I.data.selectedIndex,r=I.data.sources[o].src,h||(h=u(r)),v.select(o),h.togglePause(),l=!0),f.indexOf(i)>=0&&(h&&(h.toggleMute(),m.button.volume.toggleClass(I.css.mute)),l=!0),f.indexOf(p)>=0&&(m.playlist.toggleClass(I.css.menu),l=!0)}return l?void 0:!1}function g(e){function t(e){var t=0;if(e.offsetParent)for(;e.offsetParent;)t+=e.offsetLeft,e=e.offsetParent;else e.x&&(t+=e.x);return t}var a,n,s,o,r,l;return a=m.progress.get(0),console.log(a),n=t(a),s=a.offsetWidth,o=e.clientX-n,r=o/s,l=h,l&&l.duration&&(l.setPosition(l.duration*r),l._iO.whileplaying.apply(l)),!1}var m,v,h,x,b,I;b={selecter:{controls:".minty-controls",detail:".minty-detail",playlist:".minty-playlist",progress:".minty-progress",progressLoaded:".minty-progress-loaded",progressPlayed:".minty-progress-played",duration:".minty-duration",button:{play:".minty-button-play",volume:".minty-button-volume",menu:".minty-button-menu"}},css:{disabled:"disabled",selected:"selected",active:"active",mute:"mute",menu:"open"},data:{type:null,id:null,loop:!0,auto:!0,selectedIndex:0,sources:null}},x={add:function(e,t,a){var n={detach:function(){return remove(e,t,a)}};return window.addEventListener?e.addEventListener(t,a,!1):e.attachEvent("on"+t,a),n},remove:void 0!==window.removeEventListener?function(e,t,a){return e.removeEventListener(t,a,!1)}:function(e,t,a){return e.detachEvent("on"+t,a)},preventDefault:function(e){return e.preventDefault?e.preventDefault():(e.returnValue=!1,e.cancelBubble=!0),!1}},f()}}(jQuery,this);